import { parseEther, hexToBytes } from "viem";
import { encodeFunctionData, encodeDeployData } from "viem";
import { createWalletClient, http, custom } from "viem";
import { sepolia } from "viem/chains";
import { privateKeyToAccount } from "viem/accounts";
import { eip7702Actions } from "viem/experimental";

import * as config from './config';

async function alternativeReplay() {
    const sponsorAccount = privateKeyToAccount(config.SPONSOR_PRIVATE_KEY);
    const walletClient = createWalletClient({
        account: sponsorAccount,
        chain: sepolia,
        transport: http(config.SEPOLIA_RPC),
    }).extend(eip7702Actions());

    // 使用类型断言解决类型不匹配问题
    const existingAuthorization = {
        contractAddress: "0x6a06b2b7f83514f42764d412e54afaf4bb0265c8", 
        chainId: 11155111,
        nonce: 3,
        yParity: 0,
        r: "0xe2e9be07dfeb0bf90c2f698e15a19b1ed5d58da21b4866d757e8b2540dc6bf9d",
        s: "0x60f611a51958f964245918f1df6bc9d0274a67487fa5f4b516ec23acb531f609"
    } as any; // 使用类型断言

    const hash = await walletClient.sendTransaction({
        account: sponsorAccount,
        authorizationList: [existingAuthorization],
        to: "0x8c2451ae6edf47e9e17bcfa14062fc783df37d2f",
        data: "0xa6d0ad610000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000000600000000000000000000000007b79995e5f793a07bc00c21412e50ecae098e7f900000000000000000000000000000000000000000000000000005af3107a40000000000000000000000000000000000000000000000000000000000000000004d0e30db0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000009f61deb7909675f1330257499ac0c2428e2e1b000000000000000000000000000000000000000000000000000012309ce54000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000007b79995e5f793a07bc00c21412e50ecae098e7f900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000009f61deb7909675f1330257499ac0c2428e2e1bffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000",
        value: parseEther("0.0")
    });

    console.log("✅ Alternative replay transaction sent:", hash);
}


// 执行交易重放
alternativeReplay();